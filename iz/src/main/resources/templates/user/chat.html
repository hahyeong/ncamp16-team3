<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Izikgram</title>
    <link th:href="@{/images/Logo.png}" rel="shortcut icon" type="image/x-icon">
    <link rel="stylesheet" th:href="@{/css/default.css}">
    <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
        @theme {
            --color-main-sky-highlight: #00a3ed;
            --color-main-sky-basic: #9bdcfd;
            --color-main-red-highlight: #ff5353;
            --color-main-red-basic: #ff9898;
            --color-main-yellow-highlight: #fbc159ff;
            --color-main-yellow-basic: #fdd391;

            /* gray-400*/
            --color-light-text: oklch(0.704 0.04 256.788);
            /* gray-600 */
            --color-basic-text: oklch(0.446 0.043 257.281);
            /* gray-900 */
            --color-bold-text: oklch(0.208 0.042 265.755);
        }

        #messages::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-white mobile-container">
<div class="flex flex-col w-full md:w-[600px] md:mx-auto md:shadow-md bg-white min-h-screen pt-[120px]">
    <div class="pt-20"><header th:replace="~{header :: header} " class="pt-4 z-100"></header></div>
    <div class="ml-5 mr-5 bg-white rounded-xl shadow-lg border border-gray-100 relative">
        <div class="sticky top-0 z-10 bg-white rounded-t-xl">
            <div class="flex justify-between items-center p-4 border-b border-gray-100">
                <div class="flex items-center gap-2">
                    <div class="w-10 h-10 bg-main-sky-highlight rounded-full flex items-center justify-center text-white text-sm">
                        <img src="/images/chat.png"/>
                    </div>
                    <div>
                        <p class="text-sm">안녕하세요, <span th:text="${#authentication.getPrincipal().getUser().getNickname()}"></span>님!</p>
                        <p class="text-xs text-gray-500">무엇을 도와드릴까요?</p>
                    </div>
                </div>
                <button id="finishChatBtn" onclick="finishchat()" class="text-blue-500 text-sm hidden">
                    대화종료
                </button>
            </div>

            <div class="grid grid-cols-2 gap-3 p-4">
                <button onclick="stresschat()" class="bg-gray-100 text-black py-3 px-4 rounded-lg text-left text-sm cursor-pointer">
                    오늘의 퇴사 수치
                </button>
                <button onclick="feelchat()" class="bg-gray-100 text-black py-3 px-4 rounded-lg text-left text-sm cursor-pointer">
                    하소연하기
                </button>
                <button onclick="paydaychat()" class="bg-gray-100 text-black py-3 px-4 rounded-lg text-left text-sm cursor-pointer">
                    월급일까지 남은 일수
                </button>
                <button onclick="endtimechat()" class="bg-gray-100 text-black py-3 px-4 rounded-lg text-left text-sm cursor-pointer">
                    남은 퇴근시간
                </button>
                <button onclick="handleJobPostings()" class="bg-gray-100 text-black py-3 px-4 rounded-lg text-left text-sm cursor-pointer">
                    맞춤형 이직 공고 보기
                </button>
            </div>
        </div>

        <div id="messages" class="flex-grow overflow-y-auto px-4 space-y-2 scrollbar-hide">
            <!-- 메시지 들어갈 자리 -->
        </div>

        <div id="inputSection" class="p-4 border-t border-gray-100 hidden">
            <div class="flex items-center gap-2">
                <input id="userInput" type="text" class="flex-grow p-2 border border-gray-300 rounded-lg"
                       placeholder="메시지를 입력하세요" onkeydown="checkEnter(event)">
                <button onclick="handleGeneralChat()" class="bg-blue-500 text-white px-4 py-2 rounded-lg">
                    전송
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Thymeleaf로 사용자 데이터 주입 -->
<div id="paydayData" th:data-payday="${#authentication.getPrincipal().getUser().getPayday()}"></div>
<div id="endtimeData" th:data-endtime="${#authentication.getPrincipal().getUser().getEnd_time()}"></div>
<div id="stressData" th:data-stress="${@mainService.getStressNum(#authentication.principal.user.member_id)}"></div>

<!-- 외부 JS 파일 로드 -->
<script th:src="@{/js/chatScript.js}"></script>
</body>
</html>