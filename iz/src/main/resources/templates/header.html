<div th:fragment="header" class="fixed top-0 z-10 w-full md:w-[600px]" xmlns:sec="http://www.w3.org/1999/xhtml">
    <!-- 헤더 부분 -->
    <div class="bg-white">
        <div id="B" class="flex items-center px-10 py-2 text-white w-full h-20">
            <!-- 첫 번째 버튼 (왼쪽) -->
            <button id="openBtn" onclick="openTop()" class="text-black text-3xl cursor-pointer mt-[-6px]">☰</button>

            <!-- 로고 이미지 (가운데 정렬) -->
            <div class="flex-1 flex justify-center">
                <a th:href="@{/main}">
                    <img th:src="@{/images/izikgram.png}" alt="로고" class="w-[180px] mt-12px ml-2">
                </a>
            </div>

            <a th:href="@{/main/alarm}">
                <div class="relative">
                    <button class="text-2xl cursor-pointer mt-[-6px]"><img src="https://img.icons8.com/?size=100&id=z8yqcMdq4T2h&format=png&color=000000" class="w-8"></button>
                    <span id="alarmCount" th:if="${alarmCount > 0}"
                          class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/2 -translate-y-1/2 bg-red-600 rounded-full">
                            [[${alarmCount}]]
                    </span>
                </div>
            </a>
        </div>
    </div>


    <!-- 상단 네비게이션 바 - 컨테이너 내부에 위치 -->
    <div id="slidePanel" class="fixed top-0 md:left-1/2 w-full md:w-[600px] h-full hidden opacity-0 visibility-hidden transition-all duration-500 z-50 md:transform md:-translate-x-1/2" style="overflow: hidden;">
        <div id="sidebar" class="absolute top-0 left-0 bottom-0 bg-white shadow-lg p-5 z-50 w-4/5 overflow-y-auto">
            <!-- 사이드 바 스타일 -->
            <div class="absolute top-[-15px] left-0 w-full h-48 rounded-b-[200px]" style="background-color: #9bdcfd;"></div>
            <!-- 닫기 버튼 -->
            <button id="closeBtn" type="button" onclick="closeTop()" class="absolute top-5 right-5 text-gray-500 hover:text-gray-700 text-sm cursor-pointer z-10"><img src="https://img.icons8.com/?size=100&id=71200&format=png&color=000000" class="w-6"></button>

            <!-- 프로필 이미지 -->
            <img th:src="@{/images/chillguy.png}" class="w-[150px] h-[150px] rounded-[100px] relative mt-7 mx-auto top-14 z-10" alt="사용자프로필 이미지">
            <div class="text-center mt-20">
                <div sec:authorize="isAuthenticated()">
                    <div th:text="${#authentication.getPrincipal() != null && #authentication.getPrincipal().getUser().getNickname() != null ? #authentication.getPrincipal().getUser().getNickname() : '닉네임을 정해주세요'}"></div>
                    <div th:text="${#authentication.getPrincipal() != null && #authentication.getPrincipal().getUser().getIntro() != null ? #authentication.getPrincipal().getUser().getIntro() : '자기소개를 써주세요'}"></div>
                </div>
            </div>

            <!-- 메뉴 리스트 -->
            <nav class="mt-6 list-none space-y-2 pb-20 ml-4">
                <a th:href="@{/user/mypage}" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded">
                    <img src="https://img.icons8.com/?size=100&id=85356&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl">마이페이지</span>
                </a>

                <a th:href="@{/board/1}" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded">
                    <img src="https://img.icons8.com/?size=100&id=122808&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl"> 자유게시판</span>
                </a>

                <a th:href="@{/board/2}" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded">
                    <img src="https://img.icons8.com/?size=100&id=6669&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl">하소연게시판</span>
                </a>

                <a th:href="@{/board/hot}" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded">
                    <img src="https://img.icons8.com/?size=100&id=104&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl"> 인기게시판</span>
                </a>

                <a th:href="@{/board/myboard}" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded">
                    <img src="https://img.icons8.com/?size=100&id=dfiNvwAesiYh&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl">내 게시물</span>
                </a>

                <a th:href="@{/job/scrap}" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded">
                    <img src="https://img.icons8.com/?size=100&id=123439&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl">찜한 채용공고</span>
                </a>

                <a th:href="@{/job/hire}" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded">
                    <img src="https://img.icons8.com/?size=100&id=23877&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl">채용공고 바로가기</span>
                </a>

                <a th:href="@{/draw/draw}" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded">
                    <img src="https://img.icons8.com/?size=100&id=5N7rMqNKJWhK&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl">제비뽑기</span>
                </a>


                <a th:href="@{/logout}" class="flex items-center p-2 text-red-600 hover:bg-red-100 rounded">
                    <img src="https://img.icons8.com/?size=100&id=2445&format=png&color=000000" class="w-8 h-8"/>
                    <span class="ml-4 text-xl">로그아웃</span>
                </a>
            </nav>
        </div>

        <div class="absolute top-0 right-0 h-dvh bg-gray-950 shadow-lg p-5 z-50 w-1/5 opacity-50" onclick="closeTop()"></div>
    </div>

    <th:block>
        <script>
            function closeTop() {
                let target = document.getElementById('slidePanel');
                target.style.opacity = '0';
                target.style.visibility = 'hidden';

                // 푸터(챗봇 아이콘) z-index 복원
                let chatbotIcon = document.querySelector('.fixed.bottom-5.right-5, #chatbotIcon');
                if (chatbotIcon) {
                    chatbotIcon.style.zIndex = '50';
                }

                setTimeout(function() {
                    target.style.display = 'none';
                }, 300); // 트랜지션 시간 후에 display none 설정
            }

            function openTop() {
                let target = document.getElementById('slidePanel');
                let sidebar = document.getElementById('sidebar');

                // 푸터(챗봇 아이콘) z-index 낮추기
                let chatbotIcon = document.querySelector('.fixed.bottom-5.right-5, #chatbotIcon');
                if (chatbotIcon) {
                    chatbotIcon.style.zIndex = '1'; // 사이드바의 z-index(50)보다 확실히 낮게 설정
                }

                // 사이드바 높이를 화면 높이에 맞게 조정
                sidebar.style.height = window.innerHeight + 'px';

                target.style.display = 'block';

                // display가 적용될 시간을 주고 나서 opacity 변경
                setTimeout(function() {
                    target.style.opacity = '1';
                    target.style.visibility = 'visible';
                }, 10);
            }

            // 화면 크기가 변경될 때 사이드바 높이 조정
            window.addEventListener('resize', function() {
                let sidebar = document.getElementById('sidebar');
                if (sidebar && document.getElementById('slidePanel').style.display !== 'none') {
                    sidebar.style.height = window.innerHeight + 'px';
                }
            });

            // 페이지 로드 시 실행
            document.addEventListener('DOMContentLoaded', function() {
                // 푸터 챗봇 아이콘의 z-index 초기화
                let chatbotIcon = document.querySelector('.fixed.bottom-5.right-5, #chatbotIcon');
                if (chatbotIcon) {
                    chatbotIcon.style.zIndex = '50';
                }

                // 슬라이드 패널 상태 확인 및 챗봇 아이콘 z-index 조정
                let slidePanel = document.getElementById('slidePanel');
                if (slidePanel && slidePanel.style.display !== 'none' && slidePanel.style.opacity !== '0') {
                    // 사이드바가 열려있는 상태면 챗봇 아이콘 z-index 낮추기
                    if (chatbotIcon) {
                        chatbotIcon.style.zIndex = '30';
                    }
                }
            });
        </script>
    </th:block>
</div>