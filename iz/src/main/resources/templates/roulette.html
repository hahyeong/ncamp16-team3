<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html {
            overscroll-behavior-y: contain;
            overflow: hidden;
        }
        @keyframes popIn {
            0% { transform: scale(0.5) rotate(20deg); opacity: 0; }
            80% { transform: scale(1.1) rotate(-10deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); }
        }
        .winner-popup {
            animation: popIn 0.7s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }
        @media screen and (max-width: 599px) {
            .mobile-container {
                width: 100%;
                background: white;
                min-height: 100vh;
            }

            canvas {
                width: 90%;
                height: 90%;
            }

            #dolimPopup {
                min-width: 17em;
                font-size: 1.2em;
                line-height: 0;
                padding: 1.5em;
                text-align: center;
            }
        }
    </style>
</head>
<body class="mobile-container bg-[#f7f8fc] min-h-screen flex justify-center items-center">
<div id="initialSetup" class="w-full max-w-md p-8 bg-white rounded-xl shadow-2xl">
    <h2 class="text-2xl font-bold mb-6 text-center">Î£∞Î†õ Î©îÎâ¥ ÏÑ§Ï†ï</h2>
    <div id="menuInputs" class="space-y-4">
        <div class="flex items-center space-x-2">
            <input type="text" class="menu-input flex-grow px-4 py-2 border rounded-md" placeholder="Î©îÎâ¥ 1">
            <button onclick="addMenuInput()" class="bg-green-500 text-white px-4 py-2 rounded-md">+</button>
            <button onclick="removeMenuInput()" class="bg-red-500 text-white px-4 py-2 rounded-md">-</button>
        </div>
    </div>
    <button onclick="startRoulette()" class="w-full mt-6 bg-[#febf00] text-white py-3 rounded-full hover:bg-yellow-600 transition">
        Î£∞Î†õ ÏãúÏûë
    </button>
</div>

<div id="rouletteContainer" class="hidden mobile-container w-full max-w-4xl relative">
    <!-- ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥ -->
    <div id="debugInfo" class="absolute top-0 left-0 bg-white p-2 z-50 text-xs"></div>

    <!-- ÏäπÏûê ÌåùÏóÖ -->
    <div id="winnerPopup" class="fixed z-50 top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 hidden"></div>

    <!-- Î£∞Î†õ Ï∫îÎ≤ÑÏä§ -->
    <canvas width="600" height="600" class="mx-auto mt-[20px] transition-all"></canvas>

    <!-- ÌôîÏÇ¥Ìëú -->
    <svg id="arrow" viewBox="0 0 100 100" class="absolute top-[5px] left-1/2 transform -translate-x-1/2 w-16 h-16 z-10" style="fill: red;">
        <path d="M50 90 L30 30 L70 30 Z" />
    </svg>

    <!-- Î≤ÑÌäº Ïª®ÌÖåÏù¥ÎÑà -->
    <div id="buttonContainer" class="flex justify-center items-center space-x-4 mt-4">
        <button id="rotateButton" onclick="rotate()" class="bg-[#febf00] py-3 px-10 text-2xl font-semibold rounded-full text-[#fff] hover:bg-[#444] hover:text-[#f9f9f9] transition duration-300 transform hover:scale-105">
            ÎèåÎ†§ÎèåÎ†§ ÎèåÎ¶ºÌåê
        </button>
    </div>
</div>

<script>
    const initialSetup = document.getElementById('initialSetup');
    const rouletteContainer = document.getElementById('rouletteContainer');
    const menuInputs = document.getElementById('menuInputs');
    const $c = document.querySelector("canvas");
    const ctx = $c.getContext(`2d`);
    const rotateButton = document.querySelector('#rotateButton');
    const winnerPopup = document.querySelector('#winnerPopup');
    const debugInfo = document.getElementById('debugInfo');

    let product = [];
    const colors = ['#87CEEB', '#4682B4', '#5FA8D3']; // ÌïòÎäòÏÉâ Í≥ÑÏó¥
    let isRotating = false;
    let currentRotation = 0;

    function addMenuInput() {
        if (menuInputs.children.length < 12) {
            const newInputDiv = document.createElement('div');
            newInputDiv.classList.add('flex', 'items-center', 'space-x-2');
            newInputDiv.innerHTML = `
                <input type="text" class="menu-input flex-grow px-4 py-2 border rounded-md" placeholder="Î©îÎâ¥ ${menuInputs.children.length + 1}">
            `;
            menuInputs.appendChild(newInputDiv);
        }
    }

    function removeMenuInput() {
        if (menuInputs.children.length > 1) {
            menuInputs.removeChild(menuInputs.lastChild);
        }
    }

    function startRoulette() {
        // Î©îÎâ¥ ÏûÖÎ†• Í≤ÄÏ¶ù
        const inputs = document.querySelectorAll('.menu-input');
        product = Array.from(inputs)
            .map(input => input.value.trim())
            .filter(value => value !== '');

        if (product.length < 2) {
            alert('ÏµúÏÜå 2Í∞úÏùò Î©îÎâ¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
            return;
        }

        // Ï¥àÍ∏∞ ÏÑ§Ï†ï ÌôîÎ©¥ Ïà®Í∏∞Í≥† Î£∞Î†õ ÌôîÎ©¥ ÌëúÏãú
        initialSetup.classList.add('hidden');
        rouletteContainer.classList.remove('hidden');

        // Î£∞Î†õ Í∑∏Î¶¨Í∏∞
        newMake();
    }

    // Î£∞Î†õ Í∑∏Î¶¨Í∏∞ Ìï®Ïàò
    const newMake = () => {
        const [cw, ch] = [$c.width / 2, $c.height / 2];
        const arc = (2 * Math.PI) / product.length;

        for (let i = 0; i < product.length; i++) {
            ctx.beginPath();
            ctx.fillStyle = colors[i % colors.length];
            ctx.moveTo(cw, ch);
            ctx.arc(cw, ch, cw - 2, arc * i - Math.PI / 2, arc * (i + 1) - Math.PI / 2);
            ctx.fill();
            ctx.closePath();
        }

        ctx.strokeStyle = "#000";
        ctx.lineWidth = 1;

        ctx.fillStyle = "#000";
        ctx.font = "1.8rem Pretendard";
        ctx.textAlign = "center";

        for (let i = 0; i < product.length; i++) {
            const angle = arc * i + arc / 2 - Math.PI / 2;

            ctx.save();

            ctx.translate(
                cw + Math.cos(angle) * (cw - 50),
                ch + Math.sin(angle) * (ch - 50)
            );

            ctx.rotate(angle + Math.PI / 2);

            product[i].split(" ").forEach((text, j) => {
                ctx.fillText(text, 0, 30 * j);
            });

            ctx.restore();
        }

        ctx.fillStyle = "#000";
        ctx.beginPath();
        ctx.moveTo(cw, ch);
        ctx.arc(cw, ch, 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.closePath();
    };

    const rotate = () => {
        if (isRotating) return;
        isRotating = true;
        $c.style.transform = `initial`;
        $c.style.transition = `initial`;
        rotateButton.classList.add('hidden');

        // ÎãπÏ≤® Î©îÎâ¥ ÌëúÏãú
        setTimeout(() => {
            // ÏÑ∏Í∑∏Î®ºÌä∏ Í∞ÅÎèÑ Í≥ÑÏÇ∞
            const ran = Math.floor(Math.random() * product.length);

            // ÌôîÏÇ¥Ìëú ÏúÑÏπò(0ÎèÑ)Ïóê Ìï¥ÎãπÌïòÎäî Ïù∏Îç±Ïä§ Í≥ÑÏÇ∞
            const arc = 360 / product.length;
            const rotate = (360 - arc * (ran + 1) + 3600) + (arc / 3);

            $c.style.transform = `rotate(${rotate}deg)`;
            $c.style.transition = `2s`;

            setTimeout(() =>
                    winnerPopup.innerHTML = `
            <div id="dolimPopup" class="bg-[#febf00] text-white text-3xl font-bold px-8 py-6 rounded-2xl winner-popup shadow-2xl">
                üéâ "${product[ran]}" ÎãπÏ≤®!
            </div>
            `
                , 2000);

            // Î≤ÑÌäº Îã§Ïãú ÌëúÏãú
            const rerotateButton = document.createElement('button');
            rerotateButton.textContent = 'Îã§Ïãú ÏÑ§Ï†ïÌïòÍ∏∞';
            rerotateButton.className = 'bg-[#febf00] py-3 px-10 text-2xl font-semibold rounded-full text-[#fff] hover:bg-[#444] hover:text-[#f9f9f9] transition duration-300 transform hover:scale-105 mt-4';
            rerotateButton.onclick = () => {
                // Î£∞Î†õ ÏÑ§Ï†ï ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                rouletteContainer.classList.add('hidden');
                initialSetup.classList.remove('hidden');

                // Ï¥àÍ∏∞Ìôî
                $c.style.transform = 'rotate(0deg)';
                currentRotation = 0;
                winnerPopup.classList.add('hidden');
                isRotating = false;
                document.querySelector('#buttonContainer').removeChild(rerotateButton);
                rotateButton.classList.remove('hidden');
                debugInfo.innerHTML = '';
            };
            document.querySelector('#buttonContainer').appendChild(rerotateButton);

            winnerPopup.classList.remove('hidden');
            // 4Ï¥à ÌõÑ ÌåùÏóÖ Ï†úÍ±∞
            setTimeout(() => {
                winnerPopup.classList.add('hidden');
            }, 4000);

            winnerPopup.innerHTML="";
            isRotating = false;
        }, 1);
    };
</script>
</body>
</html>